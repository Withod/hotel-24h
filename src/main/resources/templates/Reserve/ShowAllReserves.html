<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="http://localhost:8080/style/bootstrap.min.css"
    />
    <script src="http://localhost:8080/js/jquery-3.3.1.min.js"></script>
    <script src="http://localhost:8080/js/bootstrap-table.min.js"></script>
    <title>查看所有预定信息</title>
  </head>

  <body>
    <div>
      <table id="table"></table>
    </div>

    <script>
      $(document).ready(function () {
        $("#table").bootstrapTable({
          ajax: function (request) {
            $.ajax({
              method: "GET",
              url: "http://localhost:8080/reserve/showAll",
              contentType: "application/x-www-form-urlencoded",
              dataType: "json",
              success: function (res) {
                request.success({
                  row: res.data,
                });
                $("#table").bootstrapTable("load", res.data);
              },
              error: function (error) {
                console.log(error);
              },
            });
          },
          striped: true,
          pageNumber: 1,
          pagination: true,
          sidePagination: "client",
          pageSize: 5,
          columns: [
            {
              title: "订单号",
              field: "id",
            },
            {
              title: "roomId",
              field: "roomId",
            },
            {
              title: "startDate",
              field: "startDate",
            },
            {
              title: "endDate",
              field: "endDate",
            },
            {
              title: "reserverName",
              field: "reserverName",
            },
            {
              title: "status",
              field: "status",
            },
            {
              field: "id",
              title: "操作",
              width: 150,
              formatter: (id, row, idx) => {
                return `<button class="btn btn-danger" onclick="removeReserve(${id})">删除</button>`;
              },
            },
          ],
        });
      });
      function removeReserve(id){
        const cfm = confirm(`确认要移除預定單號${id} 吗？`)
        if (cfm) {
          $.ajax({
            url: 'http://localhost:8080/reserve/delete',
            method: 'POST',
            data: {
              id: id,
            },
            contentType: 'application/x-www-form-urlencoded',
            dataType: 'json',
            success: (data) => {
              console.log(data)
              alert(['删除成功', '删除失败'][data.status])
              window.location.href = window.location.href
            },
            error: (error) => {
              console.log(error)
            },
          })
        }
      }
    </script>
  </body>
</html>
